<div class="ventas-local">
  <header class="ventas-header">
    <div>
      <h2>Venta en tienda</h2>
      <p>Seleccioná productos o escaneá códigos para construir tu carrito en cualquier momento.</p>
    </div>
    <button type="button" class="open-cart-btn" (click)="openCart()">
      <i class="fas fa-shopping-bag"></i>
      Ver carrito
      <span class="badge" *ngIf="totalItems > 0">{{ totalItems }}</span>
    </button>
  </header>

  <section class="status-row">
    <div class="status-card">
      <span class="label">Artículos en carrito</span>
      <span class="value">{{ totalItems }}</span>
    </div>
    <div class="status-card" *ngIf="lastScannedCode">
      <span class="label">Último código</span>
      <span class="value">{{ lastScannedCode }}</span>
    </div>
  </section>

  <div class="scan-feedback" *ngIf="scanFeedbackMessage" [ngClass]="scanFeedbackType">
    <i class="fas" [ngClass]="{
      'fa-check-circle': scanFeedbackType === 'success',
      'fa-info-circle': scanFeedbackType === 'info',
      'fa-exclamation-triangle': scanFeedbackType === 'error'
    }"></i>
    <span>{{ scanFeedbackMessage }}</span>
  </div>

  <section class="filters">
    <div class="filter-group">
      <label for="category">Categoría</label>
      <select id="category" [(ngModel)]="selectedCategory" (change)="filterAndSortProducts()">
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="color">Color</label>
      <select id="color" [(ngModel)]="selectedColor" (change)="filterAndSortProducts()">
        <option *ngFor="let col of colors" [value]="col">{{ col }}</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="sort">Ordenar</label>
      <select id="sort" [(ngModel)]="selectedSort" (change)="filterAndSortProducts()">
        <option value="name-asc">Nombre (A-Z)</option>
        <option value="price-asc">Precio (Menor a Mayor)</option>
        <option value="price-desc">Precio (Mayor a Menor)</option>
        <option value="most-sold">Más vendidos</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="stock">Stock</label>
      <select id="stock" [(ngModel)]="selectedStockFilter" (change)="filterAndSortProducts()">
        <option value="all">Todo</option>
        <option value="low">Poco stock</option>
        <option value="high">Mucho stock</option>
      </select>
    </div>
  </section>

  <section class="product-grid">
    <article class="product-card" *ngFor="let product of products" (click)="openModal(product)">
      <img [src]="product.image" [alt]="product.name">
      <div class="product-info">
        <h4>{{ product.name }}</h4>
        <p class="price">${{ product.price | number:'1.2-2' }}</p>
      </div>
      <div class="product-meta">
        <span class="category">{{ product.category }}</span>
        <span class="stock" [class.low]="product.stockTotal <= 10">Stock: {{ product.stockTotal }}</span>
      </div>
    </article>
  </section>
</div>

<app-product-modal
  *ngIf="showModal"
  [product]="selectedProduct"
  (productAdded)="addItemToCart($event)"
  (closeModal)="closeProductModal()">
</app-product-modal>
